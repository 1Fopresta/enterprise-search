[% INCLUDE 'header.html' title="Upload software package" %]
[% USE HTML %]

[% PROCESS 'system_tabs.html' selected="Upload software package" %]

[% IF install_success.defined %]
	[% IF install_success.0 %]
		[% msg = "Packages have been installed." %]
		[% type = "success" %]
	[% ELSE %]
		[% msg = "Installation failed: <br /> $install_success.1" %]
		[% type = "error" %]
	[% END %]
	
	[% WRAPPER 'template_message.html' type=type %]
		[% msg %]
	[% END %]
[% END %]

<h3>Software updates</h3>
[% UNLESS available_packages.defined %]
<form action="system.cgi" method="POST">	
	<input type="submit" name="submit.software_check_updates" value="Check for updates.." />
</form>

[% IF update_result.defined %]
	
	<h4>Update result:</h4>
	<ol>
	[% FOREACH line IN update_result %]
		[% color = 1 - color %]
				<li>
				[% IF color %]<span>
				[% ELSE %]<span style="background : #f2f2f2"> [% END %]
				[% HTML.escape(line) %] </span></li>
	[% END %]
	</ol>
[% END %]

[% ELSE %]

	[% UNLESS available_packages.size %]

		<p>Your system is up to date. There are currently no updatese avaialble for the 
<strong>[% bbox_version %]</strong> version of Black Box.</p>

	[% ELSE %]
	    <h4>Updates available</h4>
		[% WRAPPER 'template_table.html'
				header = ['', 'Software package', 'Version', 'Release'] %]
	
		[% FOREACH package IN available_packages %]
		
			
			[% WRAPPER 'template_table_row.html' %]
	
				<td><!-- todo: find icon --></td>
				<td>[% package.name %]</td>
				<td>[% package.version %]</td>
				<td>[% package.release %]</td>
			[% color = 1 - color %]
			[% END #row %]
		[% END #foreach %]
		[% END #table %]

		<form action="system.cgi" method="POST">
		    <input type="submit" name="submit.software_install_available" value="Install updates" style="margin-top : 1em;" />
		</form>
	[% END %]

[% END %]

<h3>Upload software package</h3>

[% IF install_result.defined %]
	<h4>Install result:</h4>

	<ol>
	[% FOREACH line IN install_result %]
		<li>
				[% IF color %]<span>
				[% ELSE %]<span style="background : #f2f2f2"> [% END %]
				[% HTML.escape(line) %] </span></li>
	[% END %]
	</ol>
[% END %]

[% IF succ_upload_file.defined %]
	[% WRAPPER 'template_message.html' type="success" %]
		[% HTML.escape(succ_upload_file) %] has been uploaded.
	[% END %]
[% ELSIF error_no_rpm_suff.defined %]
	[% WRAPPER 'template_message.html' type="error" %]
		Uploaded failed. 
		[% IF error_no_rpm_filename.defined %]
			[% HTML.escape(error_no_rpm_filename) %] is not a RPM file.
		[% ELSE %]
			File is not a RPM file.
		[% END %]
	[% END %]
[% END %]

<form enctype="multipart/form-data" method="post" action="system.cgi">
<div>
	
	<input type="file" name="package_file" />
	<input type="submit" name="package_upload_button" value="Upload software package" />
	
</div>
</form>

[% WRAPPER 'template_table.html'
	header = ['', 'Software package', 'Remove'] %]

	[% FOREACH package IN uploaded_packages %]
	
		[% WRAPPER 'template_table_row.html' %]
			
			<td><!-- --></td>
			<td>[% package %]</td>
			<td><a href="system.cgi?pkg_remove=[% package %]">Remove</a></td>
			
		[% END %]
	[% color = 1 - color %]
	[% END %]
[% END %]
<form action="system.cgi" method="post">
	<input type="submit" name="submit.software_install_uploaded" value="Install" style="margin-top : 1em;" />
</form>



[% INCLUDE 'footer.html' %]
